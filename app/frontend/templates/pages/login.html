{% extends "layouts/base.html" %}

{% block content %}
<div class="login-wrapper d-flex align-items-center justify-content-center">
    <!-- Animated background elements -->
    <div class="bg-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="login-card shadow-2xl">
        <div class="text-center mb-5">
            <div class="logo-container mb-4">
                <div class="logo-bg">
                    <i class="bi bi-shield-lock text-white display-4"></i>
                </div>
            </div>
            <h2 class="fw-black text-white h1">Welcome Back</h2>
            <p class="text-white-50">Secure Access to Your Media Vault</p>
        </div>

        <form x-data="{ 
                username: '', 
                password: '', 
                rememberMe: false,
                isLoading: false,
                error: '',
                async submit() {
                    this.isLoading = true;
                    this.error = '';
                    const formData = new FormData();
                    formData.append('username', this.username);
                    formData.append('password', this.password);
                    formData.append('remember_me', this.rememberMe);

                    try {
                        const res = await fetch('/api/v1/auth/login', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (res.ok) {
                            window.location.href = '/';
                        } else {
                            const data = await res.json();
                            this.error = data.detail || 'Invalid credentials';
                        }
                    } catch (e) {
                        this.error = 'Connection failed';
                    } finally {
                        this.isLoading = false;
                    }
                }
              }" 
              @submit.prevent="submit()"
              class="login-form">
            
            <div x-show="error" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform -translate-y-2"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 class="alert alert-glass-danger py-3 small mb-4 d-flex align-items-center" 
                 role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span x-text="error"></span>
            </div>

            <div class="input-group-modern mb-4">
                <i class="bi bi-person input-icon"></i>
                <input type="text" x-model="username" placeholder="Username" required autofocus>
                <div class="focus-border"></div>
            </div>

            <div class="input-group-modern mb-4">
                <i class="bi bi-key input-icon"></i>
                <input type="password" x-model="password" placeholder="Password" required>
                <div class="focus-border"></div>
            </div>

            <div class="d-flex align-items-center justify-content-between mb-5">
                <label class="custom-checkbox">
                    <input type="checkbox" x-model="rememberMe">
                    <span class="checkmark"></span>
                    <span class="text-white-50 small">Keep me logged in</span>
                </label>
            </div>

            <button type="submit" class="btn-modern-primary w-100 py-3 mb-3" :disabled="isLoading">
                <template x-if="isLoading">
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                </template>
                <span class="fw-bold" x-text="isLoading ? 'AUTHENTICATING...' : 'SIGN IN'"></span>
            </button>
        </form>
    </div>
</div>
{% endblock %}
