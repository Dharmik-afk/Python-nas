{% extends "layouts/base.html" %}

{% block content %}
<div class="login-wrapper d-flex align-items-center justify-content-center">
    <!-- Animated background elements -->
    <div class="bg-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="login-card shadow-2xl">
        <div class="text-center mb-5">
            <div class="logo-container mb-4">
                <div class="logo-bg">
                    <i class="bi bi-shield-lock text-white display-4"></i>
                </div>
            </div>
            <h2 class="fw-black text-white h1">Welcome Back</h2>
            <p class="text-white-50">Secure Access to Your Media Vault</p>
        </div>

        <form x-data="{ 
                username: '', 
                password: '', 
                rememberMe: false,
                isLoading: false,
                error: '',
                async submit() {
                    this.isLoading = true;
                    this.error = '';
                    const formData = new FormData();
                    formData.append('username', this.username);
                    formData.append('password', this.password);
                    formData.append('remember_me', this.rememberMe);

                    try {
                        const res = await fetch('/api/v1/auth/login', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (res.ok) {
                            window.location.href = '/';
                        } else {
                            const data = await res.json();
                            this.error = data.detail || 'Invalid credentials';
                        }
                    } catch (e) {
                        this.error = 'Connection failed';
                    } finally {
                        this.isLoading = false;
                    }
                }
              }" 
              @submit.prevent="submit()"
              class="login-form">
            
            <div x-show="error" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform -translate-y-2"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 class="alert alert-glass-danger py-3 small mb-4 d-flex align-items-center" 
                 role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span x-text="error"></span>
            </div>

            <div class="input-group-modern mb-4">
                <i class="bi bi-person input-icon"></i>
                <input type="text" x-model="username" placeholder="Username" required autofocus>
                <div class="focus-border"></div>
            </div>

            <div class="input-group-modern mb-4">
                <i class="bi bi-key input-icon"></i>
                <input type="password" x-model="password" placeholder="Password" required>
                <div class="focus-border"></div>
            </div>

            <div class="d-flex align-items-center justify-content-between mb-5">
                <label class="custom-checkbox">
                    <input type="checkbox" x-model="rememberMe">
                    <span class="checkmark"></span>
                    <span class="text-white-50 small">Keep me logged in</span>
                </label>
            </div>

            <button type="submit" class="btn-modern-primary w-100 py-3 mb-3" :disabled="isLoading">
                <template x-if="isLoading">
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                </template>
                <span class="fw-bold" x-text="isLoading ? 'AUTHENTICATING...' : 'SIGN IN'"></span>
            </button>
        </form>
    </div>
</div>

<style>
    .login-wrapper {
        min-height: calc(100vh - 200px);
        position: relative;
        overflow: hidden;
    }

    .bg-blobs {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: -1;
        filter: blur(80px);
    }

    .blob {
        position: absolute;
        border-radius: 50%;
        opacity: 0.4;
        animation: pulse 10s infinite alternate;
    }

    .blob-1 {
        width: 400px;
        height: 400px;
        background: var(--bs-primary);
        top: -100px;
        left: -100px;
    }

    .blob-2 {
        width: 300px;
        height: 300px;
        background: #6f42c1;
        bottom: -50px;
        right: -50px;
        animation-delay: -2s;
    }

    .blob-3 {
        width: 250px;
        height: 250px;
        background: #0dcaf0;
        top: 40%;
        left: 30%;
        animation-delay: -5s;
    }

    @keyframes pulse {
        from { transform: scale(1) translate(0, 0); }
        to { transform: scale(1.2) translate(50px, 50px); }
    }

    .login-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 2rem;
        padding: 3rem;
        width: 100%;
        max-width: 480px;
        z-index: 1;
    }

    .logo-container {
        display: inline-flex;
        padding: 1rem;
        background: rgba(var(--bs-primary-rgb), 0.2);
        border-radius: 1.5rem;
    }

    .logo-bg {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--bs-primary), #6f42c1);
        border-radius: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .fw-black { font-weight: 900; }

    .input-group-modern {
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        transition: all 0.3s ease;
    }

    .input-group-modern input {
        width: 100%;
        background: transparent;
        border: none;
        padding: 1.2rem 1rem 1.2rem 3.5rem;
        color: white;
        outline: none;
    }

    .input-icon {
        position: absolute;
        left: 1.2rem;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.5);
        font-size: 1.2rem;
    }

    .focus-border {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--bs-primary);
        transition: all 0.3s ease;
        transform: translateX(-50%);
    }

    .input-group-modern:focus-within {
        background: rgba(255, 255, 255, 0.1);
    }

    .input-group-modern:focus-within .focus-border {
        width: 100%;
    }

    .btn-modern-primary {
        background: linear-gradient(135deg, var(--bs-primary), #6f42c1);
        border: none;
        border-radius: 1rem;
        color: white;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        box-shadow: 0 10px 20px rgba(var(--bs-primary-rgb), 0.3);
    }

    .btn-modern-primary:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(var(--bs-primary-rgb), 0.4);
    }

    .btn-modern-primary:active {
        transform: translateY(-1px);
    }

    .alert-glass-danger {
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid rgba(220, 53, 69, 0.2);
        color: #ea868f;
        border-radius: 1rem;
    }

    /* Custom Checkbox */
    .custom-checkbox {
        display: flex;
        align-items: center;
        cursor: pointer;
        user-select: none;
    }

    .custom-checkbox input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }

    .checkmark {
        height: 20px;
        width: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        margin-right: 10px;
        position: relative;
        transition: all 0.3s ease;
    }

    .custom-checkbox:hover input ~ .checkmark {
        background: rgba(255, 255, 255, 0.2);
    }

    .custom-checkbox input:checked ~ .checkmark {
        background: var(--bs-primary);
    }

    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
        left: 7px;
        top: 3px;
        width: 6px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    .custom-checkbox input:checked ~ .checkmark:after {
        display: block;
    }
</style>
{% endblock %}
