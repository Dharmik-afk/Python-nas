{% set rel_path = (path.strip('/') + '/' + item.name) if path.strip('/') else item.name %}
{% set is_previewable = item.is_file() and item.suffix.lower() in ('.png', '.jpg', '.jpeg', '.gif', '.webp', '.svg', '.ico', '.bmp', '.mp4', '.mkv', '.webm', '.avi', '.mov', '.3gp', '.3g2', '.txt', '.md', '.py', '.js', '.html', '.css', '.json', '.yml', '.yaml', '.xml', '.sh', '.sql', '.log', '.ini', '.conf', '.bat', '.bash') %}
<div class="col animate fade-in" style="animation-delay: {{ (index0 if index0 is defined else 0) * 0.05 }}s">
    <div class="card h-100 glass-card file-card position-relative border-0 shadow-sm"
         {% if item.is_dir() %}
         hx-get="/{{ rel_path }}" 
         hx-target="#main-content" 
         hx-push-url="true"
         {% elif is_previewable %}
         @click.stop="$dispatch('open-preview', { path: '{{ rel_path }}' })"
         {% else %}
         @click="window.location.href='/download/{{ rel_path }}'"
         {% endif %}>
        
        <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
            <div class="icon-wrapper mb-3">
                {% if item.is_dir() %}
                    <img src="/static/icons/folder.svg" alt="Folder" class="main-icon">
                {% else %}
                    {% set ext = item.name.split('.')[-1].lower() if '.' in item.name else 'default' %}
                    <img src="/static/icons/{{ ext }}.svg" alt="{{ ext }}" class="main-icon" onerror="this.src='/static/icons/default.svg'">
                {% endif %}
                
                {% if not item.is_dir() %}
                    <div class="file-badge">{{ ext|upper if ext else 'FILE' }}</div>
                {% endif %}
            </div>

            <div class="text-center w-100">
                <h6 class="file-title mb-0 text-break" title="{{ item.name }}">{{ item.name }}</h6>
                {% if item.path and item.path != item.name %}
                    <small class="text-white-50 d-block text-truncate small" style="max-width: 100%;">{{ item.path }}</small>
                {% endif %}
            </div>
        </div>

        <!-- Hover Action Overlay -->
        {% include "partials/components/action_overlay.html" %}
    </div>
</div>
