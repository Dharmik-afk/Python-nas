{% for item in contents %}
    {% set rel_path = (path.strip('/') + '/' + item.name) if path.strip('/') else item.name %}
    {% set is_previewable = item.is_file() and item.suffix.lower() in ('.png', '.jpg', '.jpeg', '.gif', '.webp', '.svg', '.ico', '.bmp', '.mp4', '.mkv', '.webm', '.avi', '.mov', '.3gp', '.3g2', '.txt', '.md', '.py', '.js', '.html', '.css', '.json', '.yml', '.yaml', '.xml', '.sh', '.sql', '.log', '.ini', '.conf', '.bat', '.bash') %}
    <div class="col animate fade-in" style="animation-delay: {{ loop.index0 * 0.05 }}s">
        <div class="card h-100 glass-card file-card position-relative border-0 shadow-sm"
             {% if item.is_dir() %}
             hx-get="/{{ rel_path }}" 
             hx-target="#main-content" 
             hx-push-url="true"
             {% elif is_previewable %}
             @click.stop="$dispatch('open-preview', { path: '{{ rel_path }}' })"
             {% else %}
             @click="window.location.href='/download/{{ rel_path }}'"
             {% endif %}>
            
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="icon-wrapper mb-3">
                    {% if item.is_dir() %}
                        <img src="/static/icons/folder.svg" alt="Folder" class="main-icon">
                    {% else %}
                        {% set ext = item.name.split('.')[-1].lower() if '.' in item.name else 'default' %}
                        <img src="/static/icons/{{ ext }}.svg" alt="{{ ext }}" class="main-icon" onerror="this.src='/static/icons/default.svg'">
                    {% endif %}
                    
                    {% if not item.is_dir() %}
                        <div class="file-badge">{{ ext|upper if ext else 'FILE' }}</div>
                    {% endif %}
                </div>

                <div class="text-center w-100">
                    <h6 class="file-title mb-0 text-break" title="{{ item.name }}">{{ item.name }}</h6>
                </div>
            </div>

            <!-- Hover Action Overlay -->
            <div class="card-overlay">
                {% if not item.is_dir() %}
                <a href="/download/{{ rel_path }}" class="action-btn" title="Download" @click.stop>
                    <i class="bi bi-download"></i>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
{% endfor %}

{% if not contents %}
    <div class="col-12 animate zoom-in">
        <div class="empty-state text-center py-5 glass-card">
            <div class="empty-icon-bg mb-4">
                <i class="bi bi-folder2-open display-3 text-white-50"></i>
            </div>
            <h4 class="fw-bold">No items found</h4>
            <p class="text-white-50">This directory seems to be empty.</p>
        </div>
    </div>
{% endif %}

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.05) !important;
        border-radius: 1.25rem;
        transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        cursor: pointer;
    }

    .file-card:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.3) !important;
    }

    .icon-wrapper {
        position: relative;
        transition: transform 0.4s ease;
    }

    .file-card:hover .icon-wrapper {
        transform: scale(1.1);
    }

    .main-icon {
        width: 64px;
        height: 64px;
        object-fit: contain;
        filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
    }

    .file-badge {
        position: absolute;
        bottom: -5px;
        right: -10px;
        background: var(--bs-primary);
        color: white;
        font-size: 0.6rem;
        font-weight: 800;
        padding: 2px 6px;
        border-radius: 4px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .file-title {
        font-size: 0.9rem;
        font-weight: 500;
        color: rgba(255,255,255,0.9);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        opacity: 0;
        transition: all 0.3s ease;
    }

    .file-card:hover .card-overlay {
        opacity: 1;
    }

    .action-btn {
        width: 32px;
        height: 32px;
        background: rgba(var(--bs-primary-rgb), 0.8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .action-btn:hover {
        background: var(--bs-primary);
        transform: scale(1.1);
        color: white;
    }

    .empty-state {
        border-radius: 2rem;
        padding: 4rem 2rem;
    }

    .empty-icon-bg {
        width: 120px;
        height: 120px;
        background: rgba(255,255,255,0.03);
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    /* Animations */
    .animate {
        animation-duration: 0.5s;
        animation-fill-mode: both;
    }

    .fade-in {
        animation-name: fadeIn;
    }

    .zoom-in {
        animation-name: zoomIn;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes zoomIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
</style>
